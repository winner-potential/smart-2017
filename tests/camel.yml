version: "2"

services:
  cameldeploy:
    build:
      context: ../maven
    depends_on:
      - cameltest
  cameltest:
    build:
      context: ../camel
    restart: unless-stopped
    volumes:
      - cameltest:/measurements:rw
    ports:
      - "9990:9990"
      - "8080:8080"
    environment:
      MEASUREMENT_DELAY: 60
      WILDFLY_MANAGEMENT_USER: admin
      WILDFLY_MANAGEMENT_PASSWORD: admin
    depends_on:
      - camelreceiver
  starter:
    build:
      context: starter
    environment:
      INSTALLATION: ${INSTALLATION}
      AMOUNT: ${AMOUNT}
      DELAY: ${DELAY}
      DURATION: ${DURATION}
      SENDER: http://${SENDER}:3000
      ENDPOINT: http://${TESTMASCHINE}:1880/endpoints/pvreceiver

volumes:
  camelsender:
    driver: local
  cameltest:
    driver: local
  camelreceiver:
    driver: local
